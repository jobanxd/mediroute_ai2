<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MediRoute AI - Chat Test</title>

<style>
    body {
        font-family: 'Segoe UI', sans-serif;
        background: #f4f6f8;
        display: flex;
        justify-content: center;
        padding: 40px;
    }

    .chat-container {
        width: 600px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .chat-header {
        background: #3498db;
        color: white;
        padding: 15px 20px;
        font-size: 18px;
        font-weight: 600;
    }

    .session-box {
        padding: 10px 20px;
        border-bottom: 1px solid #eee;
        background: #fafafa;
    }

    .session-box input {
        width: 100%;
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #ddd;
    }

    .chat-messages {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        background: #f9fbfd;
    }

    .message {
        margin-bottom: 15px;
        max-width: 80%;
        padding: 10px 14px;
        border-radius: 10px;
        font-size: 14px;
        line-height: 1.4;
    }

    .user {
        background: #3498db;
        color: white;
        align-self: flex-end;
    }

    .ai {
        background: #e5e9f2;
        color: #2c3e50;
        align-self: flex-start;
    }

    .meta {
        font-size: 11px;
        margin-top: 5px;
        opacity: 0.7;
    }

    .chat-input {
        display: flex;
        padding: 15px;
        border-top: 1px solid #eee;
        gap: 10px;
    }

    .chat-input input {
        flex: 1;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #ddd;
        font-size: 14px;
    }

    .chat-input button {
        padding: 10px 20px;
        background: #2ecc71;
        border: none;
        color: white;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
    }

    .chat-input button:disabled {
        background: #95a5a6;
        cursor: not-allowed;
    }
</style>
</head>

<body>

<div class="chat-container">
    <div class="chat-header">
        üí¨ MediRoute AI Chat Test
    </div>

    <div class="session-box">
        <input type="text" id="sessionId" value="test-session-001" placeholder="Session ID">
    </div>

    <div class="chat-messages" id="chatMessages">
        <!-- Chat history appears here -->
    </div>

    <div class="chat-input">
        <input type="text" id="userInput" placeholder="Type your message..." />
        <button id="sendBtn">Send</button>
    </div>
</div>

<script>
const chatMessages = document.getElementById('chatMessages');
const sendBtn = document.getElementById('sendBtn');
const userInput = document.getElementById('userInput');
const sessionIdInput = document.getElementById('sessionId');

function addMessage(content, type, agentName = null, nextAgent = null) {
    const messageDiv = document.createElement('div');
    messageDiv.classList.add('message', type);

    messageDiv.innerHTML = `
        <div>${content}</div>
        ${type === 'ai' ? `
            <div class="meta">
                Agent: ${agentName || 'N/A'} 
                ${nextAgent ? `‚Üí Next: ${nextAgent}` : ''}
            </div>
        ` : ''}
    `;

    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

async function sendMessage() {
    const text = userInput.value.trim();
    if (!text) return;

    const sessionId = sessionIdInput.value.trim();
    if (!sessionId) {
        alert("Session ID is required");
        return;
    }

    addMessage(text, 'user');
    userInput.value = '';
    sendBtn.disabled = true;

    try {
        const response = await fetch('http://localhost:8000/chat/message', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                session_id: sessionId,
                user_input: text
            })
        });

        if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
        }

        const data = await response.json();

        addMessage(
            data.response,
            'ai',
            data.agent_name,
            data.next_agent
        );

    } catch (error) {
        addMessage(`‚ùå Error: ${error.message}`, 'ai');
    } finally {
        sendBtn.disabled = false;
    }
}

sendBtn.addEventListener('click', sendMessage);

userInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        sendMessage();
    }
});
</script>

</body>
</html>